---
title: "1.1 Работа со строками и регулярки"
date: "25 июля 2017, АНДАН"
author: "Г. Мороз"
---

<style>
.parallax {
    /* The image used */
    background-image: url("1_strings.jpg");

    /* Set a specific height */
    min-height: 300px; 

    /* Create the parallax scrolling effect */
    background-attachment: fixed;
    background-position: center;
    background-repeat: no-repeat;
    background-size: auto;
}
</style>

<div class="parallax"></div>

### 1. Как получить строку?

* следите за кавычками
```{r}
"the quick brown fox jumps over the lazy dog"
'the quick brown fox jumps over the lazy dog'
"the quick 'brown' fox jumps over the lazy dog"
'the quick "brown" fox jumps over the lazy dog'
```
* пустая строка
```{r}
""
''
character(3)
```
* преобразование
```{r}
typeof(4:7)
as.character(4:7)
```
* встроенные векторы
```{r}
letters
LETTERS
```
* пользовательские данные
```{r}
str(data.frame(letters[6:10], LETTERS[4:8]))
str(data.frame(letters[6:10], LETTERS[4:8], stringsAsFactors = FALSE))
```
<div class="parallax"></div>

### 2. Экранирование метасимволов
```{r}
"\\."
"\\$"
"\\*"
"\\+"
"\\?"
"\\|"
"\\^"
"\\["
"\\]"
"\\{"
"\\}"
"\\)"
"\\\\"
```
<div class="parallax"></div>

### 3. Операции со строками

* изменение регистра
* подсчет количества символов в строке
* сортировка строк
* соединение строк
* поиск вектора по подстроке
* разделение вектора по подстроке
* выделение подстроки по номеру

base R vs. `stringr`, `stringi`…
<div class="parallax"></div>

#### 3.1 Изменение регистра
```{r}
latin <- "tHe QuIcK BrOwN fOx JuMpS OvEr ThE lAzY dOg"
tolower(latin)
toupper(latin)
cyrillic <- "лЮбЯ, сЪеШь ЩиПцЫ, — вЗдОхНёТ мЭр, — кАйФ жГуЧ"
tolower(cyrillic)
toupper(cyrillic)
stringr::str_to_upper(latin)
stringr::str_to_lower(cyrillic)
stringr::str_to_title(latin)
```

<div class="parallax"></div>

#### 3.2 Подсчет количества символов
```{r}
nchar(latin)
stringr::str_length(latin)
```

<div class="parallax"></div>

#### 3.3 Сортировка
```{r}
unsorted_latin <- c("I", "♥", "N", "Y")
sort(unsorted_latin)
stringr::str_sort(unsorted_latin)
stringr::str_sort(unsorted_latin, locale = "lt")
unsorted_cyrillic <- c("я", "i", "ж")
stringr::str_sort(unsorted_cyrillic)
stringr::str_sort(unsorted_cyrillic, locale = "ru_UA")
```
Список локалей можно посмотреть командой `stringi::stri_locale_list()`. Еще полезные команды: `stringi::stri_locale_info` и `stringi::stri_locale_set`.

<div class="parallax"></div>
#### 3.4 Соединение

* одинаковое количество строк
```{r}
greek_abc <- c("Α", "Β", "Γ", "Δ")
latin_abc <- c("A", "B", "C", "D")
paste(greek_abc, latin_abc)
paste0(greek_abc, latin_abc)
paste(greek_abc, latin_abc, sep = "-")
paste(greek_abc, "Ы") # если векторы разной длины
```

* ... → одна строка
```{r}
paste(greek_abc, collapse = "_")
paste(greek_abc, latin_abc, collapse = "_")
paste(greek_abc, latin_abc, sep = "-", collapse = "_")
```

* `stringr`
```{r}
stringr::str_c(greek_abc, latin_abc)
stringr::str_c(greek_abc, latin_abc, sep = " ")
stringr::str_c(greek_abc, latin_abc, sep = "-")
stringr::str_c(greek_abc, collapse = "_")
stringr::str_c(greek_abc, latin_abc, collapse = "_")
stringr::str_c(greek_abc, latin_abc, sep = "-", collapse = "_")
```

<div class="parallax"></div>

#### 3.5 Поиск вектора по подстроке

<div class="parallax"></div>

#### 3.6 Разделение вектора по подстроке

<div class="parallax"></div>

#### 3.7 Выделение подстроки по номеру

<div class="parallax"></div>

### 4. Логические операции с векторами

<div class="parallax"></div>

### 5. Регулярные выражения

<div class="parallax"></div>

### 6. Задачи
#### 6.1 Чет-нечет
Напишите функцию `is.odd()`, которая возвращает значение `TRUE`, если число символов в строке нечетно, `FALSE`, если число символов в строке четно.

```{r,echo=FALSE, message = FALSE}
is.odd <- function(x){nchar(x) %% 2 == 1}
```
```{r}
is.odd(c("odd", "even", ""))
```

#### 6.2 Лишние пробелы
Напишите функцию `spaceless()`, которая убирает лишние пробелы.
```{r,echo=FALSE, message = FALSE}
spaceless <- function(x){gsub(" {1,}", " ", x)}
```
```{r}
spaceless(c("two  spaces", "five     spaces"))
```

#### 6.3 Искусственные данные по средней продолжительности сна
[В данных по продолжительности сна](https://goo.gl/dpCSV2) (1.1_sleep_hours.csv) две переменных: код испытуемого и среднее время сна. Попробуйте сделать следующий график:

```{r, echo=FALSE, message = FALSE}
library(tidyverse)
read.csv("https://goo.gl/dpCSV2") %>% 
  mutate(sex = gsub("[0-9]|_", "", code)) %>% 
  ggplot(aes(sleep_hours, fill = sex))+
  geom_density(alpha= 0.4)+
  theme_bw()+
  labs(title = "Зависимость времени сна от пола",
       caption = "искусственные данные",
       y = "плотность",
       x = "среднее время сна")
```

#### 6.4 Алфавитный порядок
Как было сказано выше, "алфавитный" порядок разный в разных локалях. Напишите функцию `ordering_in_locales`, которая на вход принимает два символа, а возвращает таблицу с информацией о том, в скольких локалях порядок соответствует поданному в функцию, а в скольких порядок обратный:
```{r, echo=FALSE, message = FALSE}
ordering_in_locales <- function(x, y){
  table(
    sapply(stringi::stri_locale_list(), function(z){
    paste(stringr::str_sort(c(x, y), locale = z), collapse = "_")}))}
```
```{r}
ordering_in_locales("i", "и")
```

<div class="parallax"></div>
Данная картинка -- изображение из книжки Яна Экхольма "Тутта Карлссон, первая и единственная, Людвиг Четырнадцатый и другие"
<div class="parallax"></div>