---
title: "2. Определение языка. Расстояния. Регулярки"
date: "25 июля 2017, АНДАН"
author: "Г. Мороз"
---

<style>
.parallax {
    /* The image used */
    background-image: url("2_distance.jpg");

    /* Set a specific height */
    min-height: 360px; 

    /* Create the parallax scrolling effect */
    background-attachment: fixed;
    background-position: center;
    background-repeat: no-repeat;
    background-size: length;
}
</style>

> "Что общего между вороном и письменным столом?" <div style="float: right; clear: right; margin: 13px;">(Л. Кэрролл)</div>

<div class="parallax"></div>

### 1. Определение языка[^1]
[^1]: Данная картинка -- рисунок Бориса Аркадьевича Диодорова  из книжки Яна Экхольма "Тутта Карлссон, первая и единственная, Людвиг Четырнадцатый и другие"

Для определения языка существует два пакета `cld2` (вероятностный) и `cld3` (нейросеть).

```{r}
udhr_24 <- read.csv("https://goo.gl/cHviY5", stringsAsFactors = FALSE, sep = "\t")
udhr_24
cld2::detect_language(udhr_24$article_text)
cld2::detect_language(udhr_24$article_text, lang_code = FALSE)
cld3::detect_language(udhr_24$article_text)
cld2::detect_language("Ты женат? Говорите ли по-английски?")
cld3::detect_language("Ты женат? Говорите ли по-английски?")
cld2::detect_language("Варкалось. Хливкие шорьки пырялись по наве, и хрюкотали зелюки, как мюмзики в мове.")
cld3::detect_language("Варкалось. Хливкие шорьки пырялись по наве, и хрюкотали зелюки, как мюмзики в мове.")
cld2::detect_language("Варчилось… Хлив'язкі тхурки викрули, свербчись навкрузі, жасумновілі худоки гривіли зехряки в чузі.")
cld3::detect_language("Варчилось… Хлив'язкі тхурки викрули, свербчись навкрузі, жасумновілі худоки гривіли зехряки в чузі.")
cld2::detect_language_mixed("Многие в нашей команде OpenDataScience занимаются state-of-the-art технологиями машинного обучения: DL-фреймворками, байесовскими методами машинного обучения, вероятностным программированием и не только.")
cld3::detect_language_mixed("Многие в нашей команде OpenDataScience занимаются state-of-the-art технологиями машинного обучения: DL-фреймворками, байесовскими методами машинного обучения, вероятностным программированием и не только.")
```


<div class="parallax"></div>

### 2. Расстояния между строками
Существует много разных метрик для измерения расстояния между строками (см. <code>?&grave;stringdist-metrics&grave;</code>), в примерах используется расстояние Дамерау — Левенштейна. Данное расстояние получается при подсчете количества операций, которые нужно сделать, чтобы перевести одну строку в другую.

* вставка ab → aNb
* удаление aOb → ab
* замена символа aOb → aNb
* перестановка символов ab → ba

```{r}
stringdist::stringdist("корова","корова")
stringdist::stringdist("коровы", c("курица", "бык", "утка", "корова", "осел"))
stringdist::stringdistmatrix(c("быки", "коровы"), c("курица", "бык", "утка", "корова", "осел"))
stringdist::stringsim("коровы", c("курица", "бык", "утка", "корова", "осел"))
stringdist::amatch(c("быки", "коровы"), c("курица", "бык", "утка", "корова", "осел"), maxDist = 2)
stringdist::ain(c("осы", "коровы"), c("курица", "бык", "утка", "корова", "осел"), maxDist = 2)
```



<div class="parallax"></div>

### 3. Регулярные выражения
Большинство функций из [раздела об операциях над векторами](https://agricolamz.github.io/2017_ANDAN_course/1_strings.html#3_%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8_%D0%BD%D0%B0%D0%B4_%D0%B2%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0%D0%BC%D0%B8) имеют следующую структуру:

* строка с которой работает функция
* образец (pattern)

#### 3.1 Экранирование метасимволов
```{r}
a <- "Всем известно, что 4$\\2 + 3$ * 5 = 17$? Да? Ну хорошо (а то я не был уверен). [|}^{|]"
stringr::str_view_all(a, "$")
stringr::str_view_all(a, "\\$")
stringr::str_view_all(a, "\\.")
stringr::str_view_all(a, "\\*")
stringr::str_view_all(a, "\\+")
stringr::str_view_all(a, "\\?")
stringr::str_view_all(a, "\\(")
stringr::str_view_all(a, "\\)")
stringr::str_view_all(a, "\\|")
stringr::str_view_all(a, "\\^")
stringr::str_view_all(a, "\\[")
stringr::str_view_all(a, "\\]")
stringr::str_view_all(a, "\\{")
stringr::str_view_all(a, "\\}")
stringr::str_view_all(a, "\\\\")
```
<div class="parallax"></div>

#### 3.2 Классы знаков

* `\\d` -- цифры. `\\D` -- не цифры.
```{r}
stringr::str_view_all("2 15 42. 42 15. 37 08 5. 20 20 20!", "\\d")
stringr::str_view_all("2 15 42. 42 15. 37 08 5. 20 20 20!", "\\D")
```

* `\\s` -- пробелы. `\\S` -- не пробелы.
```{r}
stringr::str_view_all("2 15 42. 42 15. 37 08 5. 20 20 20!", "\\s")
stringr::str_view_all("2 15 42. 42 15. 37 08 5. 20 20 20!", "\\S")
```

* `\\w` -- не пробелы и не знаки препинания. `\\S` -- пробелы и знаки препинания.
```{r}
stringr::str_view_all("два 15 42. 42 15. 37 08 5. 20 20 20!", "\\w")
stringr::str_view_all("два 15 42. 42 15. 37 08 5. 20 20 20!", "\\W")
```

* произвольная группа и обратная к ней
```{r}
stringr::str_view_all("Умей мечтать, не став рабом мечтанья", "[оауиыэёеяю]")
stringr::str_view_all("И мыслить, мысли не обожествив", "[^оауиыэёеяю]")
```

* есть еще и другие группы, см. `?regex`

<div class="parallax"></div>

#### 3.3 Группы знаков

```{r}
stringr::str_view_all("Карл у Клары украл кораллы, а Клара у Карла украла кларнет", "ар|ра")
stringr::str_view_all(" За гиппопотамом по пятам топает гиппопотам.", "(по)*")
```

### 4. Задачи
#### 4.1 Лишние пробелы
Напишите функцию `spaceless()`, которая убирает лишние пробелы.
```{r,echo=FALSE, message = FALSE}
spaceless <- function(x){gsub("\\s{1,}", " ", x)}
```
```{r}
spaceless(c("two  spaces", "five     spaces"))
```
#### 4.2 Функция для проверки полиндромности
Улучшите функцию `is.palindrome()`, чтобы она могла учесть знаки препинания, пробелы и т. п.
```{r, echo=FALSE, message = FALSE}
is.palindrome <- function(x){
  x <- gsub("\\W", "", tolower(x))
  x == paste0(rev(substring(x, 1:nchar(x), 1:nchar(x))), collapse = "")
}
```
```{r}
is.palindrome("Замучен он, но не чумаз")
is.palindrome("Замучена она, но не чумаза")
```

<div class="parallax"></div>